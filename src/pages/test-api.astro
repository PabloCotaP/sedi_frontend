---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="Test API Connection">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">Test API Connection</h1>

    <div class="bg-white rounded-lg shadow p-6">
      <button
        id="testBtn"
        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
      >
        Probar Conexión con Backend
      </button>

      <div id="result" class="mt-4 hidden">
        <div class="border rounded p-4">
          <h3 class="font-bold text-lg mb-2">Resultado:</h3>
          <pre id="resultContent" class="bg-gray-100 p-4 rounded overflow-auto">
          </pre>
        </div>
      </div>

      <div id="error" class="mt-4 hidden">
        <div class="border border-red-500 rounded p-4 bg-red-50">
          <h3 class="font-bold text-lg mb-2 text-red-700">Error:</h3>
          <pre id="errorContent" class="text-red-600"></pre>
        </div>
      </div>
    </div>

    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
      <h2 class="text-xl font-bold mb-4">Cómo usar la API en tu código:</h2>

      <div class="space-y-4">
        <div>
          <h3 class="font-semibold mb-2">1. Importa la función helper:</h3>
          <pre
            class="bg-gray-800 text-green-400 p-4 rounded overflow-auto"><code>import &#123; fetchAPI &#125; from '../lib/api';</code></pre>
        </div>

        <div>
          <h3 class="font-semibold mb-2">2. Haz peticiones GET:</h3>
          <pre
            class="bg-gray-800 text-green-400 p-4 rounded overflow-auto"><code>const data = await fetchAPI('/tu-endpoint');</code></pre>
        </div>

        <div>
          <h3 class="font-semibold mb-2">3. Haz peticiones POST:</h3>
          <pre
            class="bg-gray-800 text-green-400 p-4 rounded overflow-auto"><code>const data = await fetchAPI('/tu-endpoint', &#123;
  method: 'POST',
  body: JSON.stringify(&#123; clave: 'valor' &#125;)
&#125;);</code></pre>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<script>
  import { testConnection } from "../lib/api";

  const testBtn = document.getElementById("testBtn") as HTMLButtonElement;
  const resultDiv = document.getElementById("result") as HTMLDivElement;
  const resultContent = document.getElementById(
    "resultContent"
  ) as HTMLPreElement;
  const errorDiv = document.getElementById("error") as HTMLDivElement;
  const errorContent = document.getElementById(
    "errorContent"
  ) as HTMLPreElement;

  testBtn?.addEventListener("click", async () => {
    resultDiv.classList.add("hidden");
    errorDiv.classList.add("hidden");
    testBtn.disabled = true;
    testBtn.textContent = "Conectando...";

    try {
      const response = await testConnection();

      resultContent.textContent = JSON.stringify(response, null, 2);
      resultDiv.classList.remove("hidden");
      testBtn.classList.remove("bg-blue-500", "hover:bg-blue-700");
      testBtn.classList.add("bg-green-500", "hover:bg-green-700");
      testBtn.textContent = "Conexión Exitosa";
    } catch (error) {
      errorContent.textContent =
        error instanceof Error ? error.message : "Error desconocido";
      errorDiv.classList.remove("hidden");

      testBtn.classList.remove("bg-blue-500", "hover:bg-blue-700");
      testBtn.classList.add("bg-red-500", "hover:bg-red-700");
      testBtn.textContent = "Error en Conexión";
    } finally {
      testBtn.disabled = false;
    }
  });
</script>
