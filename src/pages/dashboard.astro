---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Sidebar from '../components/Sidebar.astro';

const images = {
  informacionPersonal: 'https://www.figma.com/api/mcp/asset/458378d0-5962-47ba-ba9b-72fd1cf1e070',
  formacionAcademica: 'https://www.figma.com/api/mcp/asset/7de181d8-8ebc-4585-8eb1-e7c56971b571',
  capacitacionDocente: 'https://www.figma.com/api/mcp/asset/a56360eb-aa79-4cdf-b537-58f278bf03a5',
  actualizacionDisciplinar: 'https://www.figma.com/api/mcp/asset/4d2c5f20-11ba-4ee3-a36b-3b4b793f84f9',
  gestionAcademica: 'https://www.figma.com/api/mcp/asset/541f244f-1ed6-4806-9601-6328f352119a',
  productosAcademicos: 'https://www.figma.com/api/mcp/asset/27da20d4-ba52-44f8-800c-28ef5ac9572c',
  expProfNoAcademica: 'https://www.figma.com/api/mcp/asset/1f55cd36-30bd-43c5-8d89-a71a3aa70331',
  expDisenoIngenieril: 'https://www.figma.com/api/mcp/asset/21558343-ad64-4df2-b708-f5f7f165404a',
  logrosProfNoAcademicos: 'https://www.figma.com/api/mcp/asset/d8c119df-db20-4214-9e5c-c1ae00e62d8d',
  participacionColegios: 'https://www.figma.com/api/mcp/asset/f95eb2dd-94d0-4e6a-814b-6687dffac366',
  premiosDistinciones: 'https://www.figma.com/api/mcp/asset/92d3b530-c600-4a5f-b366-a45bcd9cc506',
  aportacionesMejoraPE: 'https://www.figma.com/api/mcp/asset/b0bc0ea1-f339-4161-aa97-19c5d8470f2d'
};

const sections = [
  {
    title: 'Información personal',
    route: '/informacion-personal',
    image: images.informacionPersonal
  },
  {
    title: 'Formación académica',
    route: '/formacion-academica',
    image: images.formacionAcademica
  },
  {
    title: 'Capacitación docente',
    route: '/capacitacion-docente',
    image: images.capacitacionDocente
  },
  {
    title: 'Actualización disciplinar',
    route: '/actualizacion-disciplinar',
    image: images.actualizacionDisciplinar
  },
  {
    title: 'Gestión académica',
    route: '/gestion-academica',
    image: images.gestionAcademica
  },
  {
    title: 'Productos académicos relevantes',
    route: '/productos_aca_relevantes',
    image: images.productosAcademicos
  },
  {
    title: 'Experiencia profesional no académica',
    route: '/exp-prof-no-academica',
    image: images.expProfNoAcademica
  },
  {
    title: 'Experiencia en diseño ingenieril',
    route: '/exp-diseno-ingenieril',
    image: images.expDisenoIngenieril
  },
  {
    title: 'Logros profesionales no académicos',
    route: '/logros-prof-no-academicos',
    image: images.logrosProfNoAcademicos
  },
  {
    title: 'Participación en colegios, cámaras, asociaciones científicas, etc.',
    route: '/participacion-colegios',
    image: images.participacionColegios
  },
  {
    title: 'Premios, distinciones o reconocimientos recibidos',
    route: '/premios-distinciones',
    image: images.premiosDistinciones
  },
  {
    title: 'Aportaciones relevantes a la mejora del PE',
    route: '/aportaciones-mejora-pe',
    image: images.aportacionesMejoraPE
  }
];
---

<BaseLayout title="Panel de Control - SEDI">
  <Sidebar />

  <div class="flex flex-col min-h-screen bg-white ml-[133px]">
    <Header showUserInfo={true} userEmail="" />

    <main class="flex-1 bg-[#f3f3f3] px-4 py-8 sm:px-8">
      <div class="max-w-[1728px] mx-auto bg-[#f3f3f3] rounded-[25px] shadow-[0px_4px_4px_0px_rgba(0,0,0,0.25)] p-6 sm:p-12">
        <div id="viewing-user-banner" class="hidden mb-6 bg-blue-100 border-l-4 border-blue-500 p-4 rounded-r-lg">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <svg class="w-6 h-6 text-blue-500 mr-3" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
              <span class="text-blue-700 font-medium">
                Viendo expediente de: <strong id="viewing-user-name"></strong>
              </span>
            </div>
            <a href="/panel-administrador" class="bg-[#8b7355] hover:bg-[#7a6349] text-white font-semibold py-3 px-8 rounded-lg transition-colors duration-200 whitespace-nowrap">
              Regresar
            </a>
          </div>
        </div>

        <div id="sections-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-8">
          {sections.map((section) => (
            <a
              href={section.route}
              data-route={section.route}
              class="section-link bg-[#d9d9d9] rounded-[44px] shadow-[0px_4px_4px_0px_rgba(0,0,0,0.25)] p-6 no-underline transition-all duration-300 hover:-translate-y-2 hover:shadow-xl h-[236px] flex flex-col items-center justify-center"
            >
              <div class="flex items-center justify-center mb-4">
                <img 
                  src={section.image} 
                  alt={section.title}
                  class="w-[140px] h-[140px] object-contain"
                />
              </div>
              <p class="text-black text-center text-[20px] font-light leading-tight max-w-[321px] m-0">
                {section.title}
              </p>
            </a>
          ))}
        </div>
      </div>
    </main>

    <Footer />
  </div>
</BaseLayout>

<script type="module" src="/js/pages.js"></script>

<script>
  (function() {
    const token = localStorage.getItem('access_token');
    const userId = localStorage.getItem('user_id');
    
    if (!token || !userId) {
      window.location.href = '/';
      return;
    }
    
    const urlParams = new URLSearchParams(window.location.search);
    const viewingUserId = urlParams.get('userId');
    const viewingUserName = urlParams.get('userName');
    
    if (viewingUserId && viewingUserName) {
      const banner = document.getElementById('viewing-user-banner');
      const userNameSpan = document.getElementById('viewing-user-name');
      
      if (banner && userNameSpan) {
        banner.classList.remove('hidden');
        userNameSpan.textContent = decodeURIComponent(viewingUserName);
      }
      
      const sectionLinks = document.querySelectorAll('.section-link');
      sectionLinks.forEach((link) => {
        const baseRoute = link.getAttribute('data-route');
        if (baseRoute) {
          link.setAttribute('href', `${baseRoute}?userId=${viewingUserId}&userName=${viewingUserName}`);
        }
      });
      
      sessionStorage.setItem('viewing_user_id', viewingUserId);
      sessionStorage.setItem('viewing_user_name', viewingUserName);
    }
  })();
</script>
