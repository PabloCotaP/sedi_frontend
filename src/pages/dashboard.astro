---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Sidebar from '../components/Sidebar.astro';

const images = {
  informacionPersonal: 'https://www.figma.com/api/mcp/asset/d4c3cbee-90a7-46d8-a832-5ccf36e7d623',
  formacionAcademica: 'https://www.figma.com/api/mcp/asset/72e79136-bfcf-44b9-98e4-5c4b2206f8f7',
  capacitacionDocente: 'https://www.figma.com/api/mcp/asset/70ee7614-29fd-4a08-b912-2b2e565fdc1a',
  actualizacionDisciplinar: 'https://www.figma.com/api/mcp/asset/5fca4a14-b80b-4d73-965d-20c6c1093982',
  gestionAcademica: 'https://www.figma.com/api/mcp/asset/8dce4322-ef6c-45ed-88a4-6e286bfbbb76',
  productosAcademicos: 'https://www.figma.com/api/mcp/asset/b235eb4b-62d0-4c40-8da5-0463608f2248',
  expProfNoAcademica: 'https://www.figma.com/api/mcp/asset/f857adaa-e330-49ec-9041-13ffb6ea01f4',
  expDisenoIngenieril: 'https://www.figma.com/api/mcp/asset/ce2103d1-2e36-41ea-baad-7424594de720',
  logrosProfNoAcademicos: 'https://www.figma.com/api/mcp/asset/68a9623b-e4ca-4abd-92ad-99a3226e87be',
  participacionColegios: 'https://www.figma.com/api/mcp/asset/d4edaa5e-b4eb-4210-bfc8-6becf10e0056',
  premiosDistinciones: 'https://www.figma.com/api/mcp/asset/a357760b-7871-47eb-a438-8e3e80a9295e',
  aportacionesMejoraPE: 'https://www.figma.com/api/mcp/asset/e9a4af74-d62f-41e8-9315-aa543359e133'
}

const sections = [
  {
    title: 'Información Personal',
    route: '/informacion-personal',
    image: images.informacionPersonal
  },
  {
    title: 'Formación Académica',
    route: '/formacion-academica',
    image: images.formacionAcademica
  },
  {
    title: 'Capacitación Docente',
    route: '/capacitacion-docente',
    image: images.capacitacionDocente
  },
  {
    title: 'Actualización Disciplinar',
    route: '/actualizacion-disciplinar',
    image: images.actualizacionDisciplinar
  },
  {
    title: 'Gestión Académica',
    route: '/gestion-academica',
    image: images.gestionAcademica
  },
  {
    title: 'Productos Académicos Relevantes',
    route: '/productos_aca_relevantes',
    image: images.productosAcademicos
  },
  {
    title: 'Experiencia Profesional No Académica',
    route: '/exp-prof-no-academica',
    image: images.expProfNoAcademica
  },
  {
    title: 'Experiencia en Diseño Ingenieril',
    route: '/exp-diseno-ingenieril',
    image: images.expDisenoIngenieril
  },
  {
    title: 'Logros Profesionales No Académicos',
    route: '/logros-prof-no-academicos',
    image: images.logrosProfNoAcademicos
  },
  {
    title: 'Participación en Colegios, Cámaras y Asociaciones',
    route: '/participacion-colegios',
    image: images.participacionColegios
  },
  {
    title: 'Premios, Distinciones y Reconocimientos',
    route: '/premios-distinciones',
    image: images.premiosDistinciones
  },
  {
    title: 'Aportaciones a la Mejora del Plan de Estudios',
    route: '/aportaciones-mejora-pe',
    image: images.aportacionesMejoraPE
  }
];
---

<BaseLayout title="Panel de Control - SEDI">
  <Sidebar />

  <div class="flex flex-col min-h-screen bg-white ml-[133px]">
    <Header showUserInfo={true} />

    <main class="flex-1 bg-[#f3f3f3] px-4 py-8 sm:px-8">
      <div class="max-w-[1728px] mx-auto bg-[#f3f3f3] rounded-[25px] shadow-[0px_4px_4px_0px_rgba(0,0,0,0.25)] p-6 sm:p-12">
        <div id="viewing-user-banner" class="hidden mb-6 bg-blue-100 border-l-4 border-blue-500 p-4 rounded-r-lg">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <svg class="w-6 h-6 text-blue-500 mr-3" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
              <span class="text-blue-700 font-medium">
                Viendo expediente de: <strong id="viewing-user-name"></strong>
              </span>
            </div>
            <a href="/panel-administrador" class="bg-[#8b7355] hover:bg-[#7a6349] text-white font-semibold py-3 px-8 rounded-lg transition-colors duration-200 whitespace-nowrap">
              Regresar
            </a>
          </div>
        </div>

        <div id="sections-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-8">
          {sections.map((section) => (
            <a
              href={section.route}
              data-route={section.route}
              class="section-link bg-[#d9d9d9] rounded-[44px] shadow-[0px_4px_4px_0px_rgba(0,0,0,0.25)] p-6 no-underline transition-all duration-300 hover:-translate-y-2 hover:shadow-xl h-[236px] flex flex-col items-center justify-center"
            >
              <div class="flex items-center justify-center mb-4">
                <img 
                  src={section.image} 
                  alt={section.title}
                  class="w-[140px] h-[140px] object-contain"
                />
              </div>
              <p class="text-black text-center text-[20px] font-light leading-tight max-w-[321px] m-0">
                {section.title}
              </p>
            </a>
          ))}
        </div>
      </div>
    </main>

    <Footer />
  </div>
</BaseLayout>

<script type="module" src="/js/pages.js"></script>

<script>
  (function() {
    const token = localStorage.getItem('access_token');
    const userId = localStorage.getItem('user_id');
    
    if (!token || !userId) {
      window.location.href = '/';
      return;
    }
    
    const urlParams = new URLSearchParams(window.location.search);
    const viewingUserId = urlParams.get('userId');
    const viewingUserName = urlParams.get('userName');
    
    if (viewingUserId && viewingUserName) {
      const banner = document.getElementById('viewing-user-banner');
      const userNameSpan = document.getElementById('viewing-user-name');
      
      if (banner && userNameSpan) {
        banner.classList.remove('hidden');
        userNameSpan.textContent = decodeURIComponent(viewingUserName);
      }
      
      const sectionLinks = document.querySelectorAll('.section-link');
      sectionLinks.forEach((link) => {
        const baseRoute = link.getAttribute('data-route');
        if (baseRoute) {
          link.setAttribute('href', `${baseRoute}?userId=${viewingUserId}&userName=${viewingUserName}`);
        }
      });
      
      sessionStorage.setItem('viewing_user_id', viewingUserId);
      sessionStorage.setItem('viewing_user_name', viewingUserName);
    }
  })();
</script>
